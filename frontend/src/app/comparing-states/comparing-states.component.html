<div class="comparing-container">
  <header>
    <img src="assets/logo-hor.svg" alt="DATA ROOTS Logo" class="logo" />
  </header>

  <div class="go-back">
    <button class="btn" routerLink="/home">Voltar</button>
  </div>

  <div class="filters-container">
    <button
      [class.active]="tipo === 'permanente'"
      (click)="setTipo('permanente')"
    >
      Permanente
    </button>
    <button
      [class.active]="tipo === 'temporaria'"
      (click)="setTipo('temporaria')"
    >
      Temporária
    </button>

    <div>
      <label for="ano">Ano</label>
      <input
        id="ano"
        type="number"
        [(ngModel)]="selectedAno"
        placeholder="Ex: 2020"
        min="1974"
        max="2023"
        (change)="fetchProducts()"
      />
    </div>

    <div>
      <label for="produto">Produto</label>
      <select
        id="produto"
        [(ngModel)]="selectedProduto"
        [disabled]="!selectedAno || loadingCompare"
      >
        <option *ngFor="let produto of produtos" [value]="produto.produto">
          {{ produto.produto }}
        </option>
      </select>
    </div>

    <div class="comparing-btn">
      <button
        class="btn btn-primary"
        (click)="compare()"
        [disabled]="!selectedAno || loadingCompare || !selectedProduto"
      >
        {{ loadingCompare ? "Carregando..." : "Comparar" }}
      </button>
    </div>
  </div>

  <div
    class="products-container"
    *ngIf="!loadingCompare && comparison.length > 0"
  >
    <div class="card div-table">
      <h2>Dados por Estado</h2>
      <table class="table">
        <thead>
          <tr>
            <th>Estado</th>
            <th>Produção</th>
            <th>Área Colhida</th>
            <th>Área Destinada à Colheita</th>
            <th>Rendimento Médio</th>
            <th>Valor Produzido</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of comparison">
            <td>{{ c.sigla_uf | ufName }}</td>
            <td>{{ c.total_producao | number : "1.0-2" }}</td>
            <td>{{ c.area_colhida | number : "1.0-2" }}</td>
            <td>{{ c.area_destinada_colheita | number : "1.0-2" }}</td>
            <td>{{ c.rendimento_medio_producao | number : "1.0-2" }}</td>
            <td>
              {{ c.valor_producao | currency : "BRL" : "symbol" : "1.0-2" }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="comparison.length > 0" class="card">
    <div echarts [options]="chartOptions" class="chart"></div>
  </div>
</div>
